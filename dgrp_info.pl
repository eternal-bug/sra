#!/usr/bin/perl
use strict;
use warnings;

use Getopt::Long;
use Pod::Usage;
use YAML qw(Dump Load DumpFile LoadFile);

use List::MoreUtils qw(uniq zip);

use FindBin;
use lib "$FindBin::Bin/lib";

use MySRA;

my $mysra = MySRA->new;

my @ids = (
    391, 517, 375, 321, 40,  852, 176, 57,  380, 208, 38,  138, 727, 443,
    757, 897, 738, 332, 181, 406, 177, 320, 737, 392, 357, 492, 377, 502,
    508, 381, 426, 370, 373, 892, 405, 857, 359, 837, 461, 908, 42,  142,
    555, 383, 513, 887, 855, 441, 235, 75,  531, 707, 882, 439, 907, 714,
    790, 822, 799, 440, 639, 427, 705, 894, 83,  765, 732, 812, 237, 712,
    805, 890, 21,  365, 49,  399, 59,  810, 358, 776, 352, 787, 509, 318,
    796, 535, 761, 804, 26,  491, 818, 85,  195, 93,  45,  356, 859, 820,
    239, 73,  136, 28,  280, 256, 563, 161, 703, 149, 642, 832, 69,  730,
    911, 91,  105, 783, 88,  41,  217, 374, 884, 309, 589, 367, 595, 310,
    591, 721, 716, 233, 646, 808, 101, 861, 228, 227, 313, 325, 158, 801,
    786, 879, 379, 208, 371, 386, 338, 301, 517, 427, 802, 437, 315, 129,
    774, 307, 765, 229, 391, 109, 350, 639, 313, 379, 707, 409, 852, 324,
    153, 362, 714, 317, 555, 365, 730, 712, 786, 859, 375, 303, 705, 799,
    774, 820, 287, 335, 358, 360, 399, 732, 357, 486, 437, 304, 362, 380,
    306,
);
@ids = uniq(@ids);

my $master = {};
for my $id (@ids) {
    my $name = "DGRP-$id";
    print "$name\n";
    my @srx = @{ $mysra->srs_worker($name) };
    print "@srx\n";

    my $sample = {};
    for (@srx) {
        $sample->{$_} = $mysra->srx_worker($_);
    }
    $master->{$name} = $sample;
    print "\n";
}

DumpFile( "dgrp.yml", $master );
